[{"name":"Tree Map","lastEditorName":" Администратор","lastModified":"2020-04-21T16:29:26.812+03:00","background":{"type":0,"imageGuid":null,"color":"rgba(255,255,255,0)"},"sheets":[{"guid":"ed0c17b4ba5d481a9a60d2ee686d2a4b","name":"Новый лист 1","position":0,"widgets":[{"name":"Treemap","drilldownEnabled":false,"controlPanel":{"enabled":false},"properties":[],"propertiesJson":"{\n    \"tooltipFontSize\": \"20px\",\n    \"labelFontSize\": \"20px\",\n    \"labelFontWeight\": \"bold\",\n    \"labelFontColor\": \"\",\n    \"labelTextOutline\": \"0px contrast\",\n    \"colors\": [\"#FDCE18\", \"#31475D\", \"#9DB1CF\", \"#D0DAE8\", \"#B45E40\", \"#EDAE58\", \"#F5D897\", \"#767676\", \"#A29FA2\"],\n    \"colorsSecondLevel\": [\"#FDCE18\", \"#31475D\", \"#9DB1CF\", \"#D0DAE8\", \"#B45E40\", \"#EDAE58\", \"#F5D897\", \"#767676\", \"#A29FA2\"]\n}","guid":"5a98ce3cdac04497855a5fe91f5bb6ee","type":"UserWidget","position":{"x":30,"y":30},"positionLocked":false,"size":{"width":1220,"height":660},"title":{"enabled":null,"autoSize":false,"text":"Статистика проданных автомобилей по их количеству, маркам и моделям. Treemap","link":null,"linkEnabled":null,"background":{"enabled":null,"color":{"colorType":null,"color":"rgba(255,255,255,1.00)","gradientColor":{"colorStart":null,"colorEnd":null}}},"textStyle":{"color":"rgba(96,125,139,1.00)","fontSize":15,"fontFamily":"Open Sans","align":null,"verticalAlign":null,"lineHeight":null,"isBold":true,"isItalic":null},"size":{"width":null,"height":null}},"frame":{"enabled":null,"style":{"radius":4,"colorType":null,"color":null,"gradientColor":{"colorStart":null,"colorEnd":null}}},"background":{"enabled":true,"color":{"colorType":null,"color":"rgba(255,255,255,1.00)","gradientColor":{"colorStart":null,"colorEnd":null}}},"boxShadow":{"x":4,"y":4,"blur":15,"spread":8,"color":"rgba(0,0,0,0.0588235294117647)"},"zIndex":1,"selectedFilterValues":{"values":[],"range":{"min":null,"max":null},"useRange":false,"useExcluding":false},"multiselectEnabled":true,"userChangedSelectedValuesInCurrentSession":false,"colorPalette":[{"id":"cb374a832342428cb43a0453a9b72566","value":"rgba(0,0,255,1.00)"},{"id":"2abdb6d33c6d488ea6fd2c4cf523ca3c","value":"rgba(255, 217, 0, 1)"},{"id":"d2ae42eb1a4f4d1eac27459dc0eb3117","value":"rgba(255, 70, 69, 1)"},{"id":"26c5d132a4384d46a23c2768257ecbaf","value":"rgba(181, 181, 181, 1)"},{"id":"b2f7bff68a584b308410f6102e232b31","value":"rgba(60, 146, 255, 1)"},{"id":"4fa8c45c46a04d0c965c0a3804fe691b","value":"rgba(100, 229, 114, 1)"},{"id":"0ff19cc5f29448fb82c78d5fd2ca535b","value":"rgba(255, 150, 85, 1)"},{"id":"0d1cfcf63ce64a37867fd95aeb74d7f2","value":"rgba(255, 242, 99, 1)"},{"id":"04369ae8d3714e1ab6f9e842b3b5bfb6","value":"rgba(106, 249, 196, 1)"},{"id":"93cc8a9f2f0f430a816dfc863692b8a8","value":"rgba(145, 232, 225, 1)"}],"useCustomColors":false,"allowedDatasourceType":[2,3,4,5,6],"codeEditableEnabled":true,"overriddenCode":"var n_level = w.data.rows[0].length;\nvar _data = {};\nvar result = [];\nvar _tempIndex = 0;\nvar _uniqValuessecondLevel = [];\nvar _colorForSecondLevel = [];\n\n//Создаю общтй массив цветов для всех уровней\nvar colors =[w.props.colors.concat(Highcharts.getOptions().colors)];\nif(w.props.colorsSecondLevel.length > 0){\n   colors.push(w.props.colorsSecondLevel);\n}\n\n\n//Формирую объекты для серии\nfor (var i=0;i < w.data.rows[0].length;i++){\n    //для всех элементов беру только сам элемент и его родителей и склеиваю в строку\n     var arr = w.data.rows.map(function (x){\n        return x.slice(0,i+1).join('&$')\n    });\n    //Убираю дубликаты\n    arr = arr.filter(function(item, pos) {\n        return arr.indexOf(item) == pos;\n    });\n    //Делаю объект\n    arr = arr.map(function(item, index){\n        var temp = item.split('&$');\n        var lvl = temp.length;\n        //console.log(temp)\n        var _res = {};\n        //console.log(temp);\n        _res['name'] = temp[temp.length - 1];\n        _res['id'] = item;\n        _res['parent'] = temp.slice(0, temp.length-1).join('&$');\n        //console.log(_res);\n        if (lvl === n_level){ //Заполняем значения для последнего уровня\n            _res['value'] = +(Number(w.data.values[0][index])).toFixed()\n        }\n        if (lvl <= colors.length){ //заполняем цвета\n            _res['color'] = colors[lvl-1][index % colors[lvl-1].length]\n        }\n        //console.log(n_level)\n        return _res;\n    });\n    result = result.concat(arr);\n}\n//console.log(result);\nHighcharts.chart({\n    chart: {\n        renderTo: w.general.renderTo\n    },\n    tooltip:{\n        style:{\n            \"fontSize\": w.props.tooltipFontSize\n        }\n    },\n    plotOptions:{\n        treemap:{\n            dataLabels:{\n                style:{\n                    \"fontSize\": w.props.labelFontSize,\n                    \"textOutline\": w.props.labelTextOutline,\n                    \"color\": w.props.labelFontColor\n                }\n            }\n        }\n    },\n    series: [{\n        type: 'treemap',\n        layoutAlgorithm: 'squarified',\n        allowDrillToNode: true,\n        animationLimit: 1000,\n        dataLabels: {\n            enabled: false\n        },\n        opacity: 0,\n        levelIsConstant: true,\n        levels: [{\n            level: 1,\n            dataLabels: {\n                enabled: true\n            },\n            borderWidth: 3\n        }],\n        data: result\n    }]\n});","dataSettings":{"datasourceType":6,"tableData":"[[\"\",\"Серия 1\",\"Серия 2\",\"Серия 3\"],[\"Значение 1\",\"100\",\"400\",\"200\"],[\"Значение 2\",\"50\",\"700\",\"250\"],[\"Значение 3\",\"300\",\"0\",\"100\"]]","olapSettings":{"impacts":[],"olapGroups":[{"id":"8c98c3e24c17413c8ac0de873efa12b1","measureGroup":{"id":"Statistika_prodazh_avtomobilei"},"olapGroupMode":0,"measures":[{"olapMeasureId":"Kolichestvo_avtomobilei","guid":"6c0b1ee926e04108a18b02e4ff42373e","sort":0,"aggregator":0}],"calculatedMeasures":[],"attributeGroupsInRows":[{"guid":"93116c4c0a9546d79ca5efd00fb66ecd","attributes":[{"id":"car_brand","dimensionOrDimensionRoleId":{"value":"Avtomobili","type":"DimensionId"}}],"groupSelectionEnabled":false,"total":false},{"guid":"5083a00eabeb492bacf184cb3ddb95c8","attributes":[{"id":"car_model","dimensionOrDimensionRoleId":{"value":"Avtomobili","type":"DimensionId"}}],"groupSelectionEnabled":false,"total":false}],"attributeGroupsInColumns":[],"dimensionAttribute":null,"filters":[],"dateRangeFilter":null,"showAllDimensionValues":false,"showEmptyDimensionValues":false,"runningTotal":{"mode":2,"enabled":false,"usePeriodicity":false,"periodGranularity":0,"start":{"type":0,"fixedDateRange":{"date":"2020-04-21T13:29:01.538Z"},"relativeDateRange":{"offsetPeriod":0,"dateStartingPointType":1,"relativeDateRangeType":1,"offset":0}}},"rowTotal":false,"columnTotal":false,"dimensionOrDimensionRoleIdForDefaultSelectedValues":null}],"limit":{"rowsLimit":0,"columnsLimit":0},"useLimit":false,"defaultSelectedValuesSettings":{"mode":0,"from":{"offsetPeriod":0,"dateStartingPointType":1,"relativeDateRangeType":1,"offset":0},"to":{"offsetPeriod":0,"dateStartingPointType":1,"relativeDateRangeType":1,"offset":0},"selectedValuesCount":1}},"rawOlapSettings":{"measureGroup":{"id":null,"columns":[],"filters":[]}},"pythonSettings":{"scriptId":null,"variableName":null,"impactsOnWidgetsEnabled":false},"csSettings":{"scriptId":null,"variableName":null,"impactsOnWidgetsEnabled":false},"calculatedColumnsSettings":{"calculatedColumns":[]},"columnsVisibilitySettings":{"mode":1,"enabled":false,"cols":[]},"nullValueHandlingSettings":{"nullToZero":false,"hideEmptyRows":false,"hideEmptyColumns":true},"factorAnalysisSettings":{"target":null,"factors":[],"l1":0.5,"l2":0.5,"dataTrainTestSegregation":0.5,"model":null}},"themeGuid":null,"numberFormat":{"precision":null,"useGrouping":null,"groupSeparator":null}}],"size":{"width":1280,"height":720},"fit":0,"color":"rgba(255,255,255,0.00)"}],"roles":[{"name":"Администратор"}],"users":["demo"],"grantedPublicAccess":false,"grid":{"enabled":true},"viQubeDatabaseId":"ViQube","guid":"fd772789ffd74048a94fa4fb9f4e58f7"}]